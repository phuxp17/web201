<!-- <!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code free</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #1e293b, #0f172a);
            color: #f8fafc;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        .container {
            background: rgba(30, 41, 59, 0.9);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
            text-align: center;
            max-width: 320px;
            width: 100%;
            border: 1px solid rgba(148, 163, 184, 0.3);
        }

        input {
            width: 100%;
            padding: 10px;
            border: 1px solid #64748b;
            border-radius: 6px;
            font-size: 14px;
            margin-bottom: 15px;
            outline: none;
            background: #0f172a;
            color: #f8fafc;
            transition: border 0.2s;
        }

        input::placeholder {
            color: #94a3b8;
        }

        input:focus {
            border-color: #3b82f6;
        }

        button {
            background-color: #3b82f6;
            color: white;
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s, transform 0.1s;
        }

        button:hover {
            background-color: #2563eb;
            transform: scale(1.05);
        }

        img {
            display: block;
            margin: 15px auto 0;
            border-radius: 8px;
            background: white;
            padding: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <input id="qr" placeholder="Enter url">
        <img alt="QR Code" id="qrimg">
        <button 
            onclick="qrimg.src='https://api.qrserver.com/v1/create-qr-code/?size=150x150&data='+encodeURIComponent(qr.value)">
            Generate
        </button>
    </div>
</body>
</html>
 -->
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>V≈© Tr·ª• AI Mobile</title>
    
    <!-- Import MediaPipe -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>

    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #000;
            font-family: 'Segoe UI', sans-serif;
            touch-action: none;
        }

        canvas#sky {
            display: block;
            width: 100vw;
            height: 100vh;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }

        /* Video Debug: Hi·ªÉn th·ªã nh·ªè ·ªü g√≥c ƒë·ªÉ bi·∫øt cam c√≥ ch·∫°y ko */
        .input_video {
            position: absolute;
            bottom: 10px;
            right: 10px;
            width: 120px; /* Nh·ªè g·ªçn */
            height: 160px;
            object-fit: cover;
            border-radius: 10px;
            border: 2px solid #00ff88;
            z-index: 100; /* Lu√¥n n·ªïi l√™n tr√™n */
            opacity: 0.8;
            transform: scaleX(-1); /* L·∫≠t g∆∞∆°ng cho t·ª± nhi√™n */
        }

        /* M√†n h√¨nh Ch√†o m·ª´ng / N√∫t Start */
        #start-screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 200;
            color: white;
            text-align: center;
        }

        #start-btn {
            background: linear-gradient(45deg, #00ff88, #00ccff);
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: bold;
            color: #000;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* B·∫£ng log tr·∫°ng th√°i */
        #debug-log {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #00ff88;
            background: rgba(0,0,0,0.7);
            padding: 5px 10px;
            font-family: monospace;
            font-size: 12px;
            border-radius: 5px;
            z-index: 101;
            pointer-events: none;
            max-width: 80%;
        }

        /* Modal th√¥ng ƒëi·ªáp */
        #modal {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background: rgba(20, 30, 50, 0.95);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            color: white;
            border: 1px solid #00ccff;
            opacity: 0;
            visibility: hidden;
            transition: 0.3s;
            z-index: 150;
            width: 80%;
        }
        #modal.show {
            opacity: 1; visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }
    </style>
</head>
<body>

    <!-- M√†n h√¨nh b·∫Øt ƒë·∫ßu -->
    <div id="start-screen">
        <h1>V≈® TR·ª§ AI</h1>
        <p>1. C·∫•p quy·ªÅn Camera<br>2. ƒê∆∞a tay l√™n tr∆∞·ªõc m√†n h√¨nh</p>
        <button id="start-btn" onclick="startApp()">B·∫ÆT ƒê·∫¶U NGAY üöÄ</button>
    </div>

    <!-- Log hi·ªÉn th·ªã l·ªói/tr·∫°ng th√°i -->
    <div id="debug-log">Ch·ªù ng∆∞·ªùi d√πng nh·∫•n B·∫Øt ƒë·∫ßu...</div>

    <!-- Video th·∫≠t ƒë·ªÉ debug -->
    <video class="input_video" playsinline muted></video>

    <!-- Canvas v·∫Ω sao -->
    <canvas id="sky"></canvas>

    <!-- Modal -->
    <div id="modal">
        <h2 style="color:#00ccff; margin:0 0 10px 0">TH√îNG ƒêI·ªÜP</h2>
        <p id="msg-content" style="font-size:1.3em; font-weight:bold">...</p>
        <p style="font-size:0.8em; color:#aaa; margin-top:20px">(N·∫Øm tay ƒë·ªÉ ƒë√≥ng)</p>
    </div>

    <script>
        const log = document.getElementById('debug-log');
        const video = document.querySelector('.input_video');
        const canvas = document.getElementById('sky');
        const ctx = canvas.getContext('2d');
        const modal = document.getElementById('modal');
        const msgContent = document.getElementById('msg-content');

        let width, height;
        let stars = [];
        let camera;
        let hands;
        let isRunning = false;
        
        // Tr·∫°ng th√°i tay
        let hand = { x: -100, y: -100, gesture: 'NONE', active: false };
        let rotation = 0;
        let speed = 0.0005;

        const messages = [
            "B·∫°n th·∫≠t tuy·ªát v·ªùi!", "H√£y c∆∞·ªùi l√™n nh√©!", "May m·∫Øn ƒëang ƒë·∫øn!", 
            "Tin v√†o ch√≠nh m√¨nh.", "V≈© tr·ª• y√™u b·∫°n.", "M·∫°nh m·∫Ω l√™n!"
        ];

        // --- H·ªÜ TH·ªêNG SAO ---
        class Star {
            constructor() { this.reset(); }
            reset() {
                const r = Math.min(width, height) * (0.2 + Math.random() * 1.5);
                const a = Math.random() * Math.PI * 2;
                this.x = r * Math.cos(a);
                this.y = r * Math.sin(a);
                this.size = Math.random() * 2 + 0.5;
                this.blink = Math.random();
                this.color = Math.random() < 0.1 ? '#00ff88' : '#ffffff';
                this.special = Math.random() < 0.1;
                if(this.special) this.size += 3;
            }
            draw() {
                this.blink += 0.05;
                const s = this.size + Math.sin(this.blink) * (this.special ? 2 : 0.5);
                ctx.beginPath();
                ctx.arc(this.x, this.y, Math.max(0, s), 0, Math.PI*2);
                ctx.fillStyle = this.color;
                if(this.special) {
                    ctx.shadowBlur = 10; ctx.shadowColor = this.color;
                } else {
                    ctx.shadowBlur = 0;
                }
                ctx.fill();
            }
        }

        function initStars() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
            stars = [];
            for(let i=0; i<200; i++) stars.push(new Star());
        }

        // --- X·ª¨ L√ù AI ---
        function onResults(results) {
            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                log.innerText = "‚úÖ ƒê√É TH·∫§Y TAY! (Di chuy·ªÉn ƒë·ªÉ th·ª≠)";
                log.style.color = "#00ff88";

                const lm = results.multiHandLandmarks[0];
                const index = lm[8]; // Ng√≥n tr·ªè
                
                // Chuy·ªÉn t·ªça ƒë·ªô (L·∫≠t ngang v√¨ l√† cam tr∆∞·ªõc)
                let x = (1 - index.x) * width;
                let y = index.y * height;

                // L√†m m∆∞·ª£t
                hand.x += (x - hand.x) * 0.5;
                hand.y += (y - hand.y) * 0.5;
                hand.active = true;

                // Xoay v≈© tr·ª•
                if (x < width * 0.3) speed = -0.005;
                else if (x > width * 0.7) speed = 0.005;
                else speed = 0;

                // Check gesture (M·ªü/ƒê√≥ng)
                // Kho·∫£ng c√°ch ng√≥n c√°i (4) v√† ng√≥n tr·ªè (8)
                const d = Math.hypot(lm[4].x - lm[8].x, lm[4].y - lm[8].y);
                // console.log(d); // Debug kho·∫£ng c√°ch n·∫øu c·∫ßn
                
                if (d > 0.15) { // X√≤e tay
                    if (!modal.classList.contains('show')) checkClick();
                } else if (d < 0.05) { // N·∫Øm tay/Ch·ª•m
                    if (modal.classList.contains('show')) modal.classList.remove('show');
                }

            } else {
                log.innerText = "üëÄ ƒêang t√¨m tay... (ƒê∆∞a tay v√†o khung)";
                log.style.color = "yellow";
                hand.active = false;
                speed = 0.0005;
            }
        }

        function checkClick() {
            // T√¨m sao g·∫ßn nh·∫•t
            const cos = Math.cos(rotation), sin = Math.sin(rotation);
            const cx = width/2, cy = height/2;
            
            for(let s of stars) {
                if(!s.special) continue;
                // T·ªça ƒë·ªô th·ª±c tr√™n m√†n h√¨nh
                const sx = cx + (s.x * cos - s.y * sin);
                const sy = cy + (s.x * sin + s.y * cos);
                
                if (Math.hypot(sx - hand.x, sy - hand.y) < 50) {
                    msgContent.innerText = messages[Math.floor(Math.random()*messages.length)];
                    modal.classList.add('show');
                    if(navigator.vibrate) navigator.vibrate(100);
                    break;
                }
            }
        }

        // --- KH·ªûI ƒê·ªòNG ---
        async function startApp() {
            document.getElementById('start-screen').style.display = 'none';
            log.innerText = "‚è≥ ƒêang kh·ªüi ƒë·ªông Camera & AI...";

            // 1. Setup MediaPipe
            hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
            hands.setOptions({
                maxNumHands: 1,
                modelComplexity: 0, // Lite mode (nhanh nh·∫•t cho mobile)
                minDetectionConfidence: 0.5,
                minTrackingConfidence: 0.5
            });
            hands.onResults(onResults);

            // 2. Setup Camera Th·ªß C√¥ng (Tin c·∫≠y h∆°n Camera Utils tr√™n m·ªôt s·ªë m√°y)
            try {
                // Y√™u c·∫ßu quy·ªÅn Cam
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: 'user', // Cam tr∆∞·ªõc
                        width: { ideal: 640 }, // Gi·∫£m ƒë·ªô ph√¢n gi·∫£i ƒë·ªÉ nh·∫π m√°y
                        height: { ideal: 480 }
                    }
                });

                video.srcObject = stream;
                // QUAN TR·ªåNG: Ph·∫£i g·ªçi play()
                await video.play();

                log.innerText = "üì∑ Camera ƒë√£ b·∫≠t. ƒêang t·∫£i m√¥ h√¨nh...";

                // B·∫Øt ƒë·∫ßu v√≤ng l·∫∑p g·ª≠i ·∫£nh sang AI
                async function aiLoop() {
                    if (video.readyState >= 2) {
                        await hands.send({image: video});
                    }
                    requestAnimationFrame(aiLoop);
                }
                aiLoop();

            } catch (err) {
                console.error(err);
                log.innerText = "‚ùå L·ªói: " + err.message + " (H√£y ki·ªÉm tra quy·ªÅn Camera/HTTPS)";
                log.style.color = "red";
                alert("Kh√¥ng m·ªü ƒë∆∞·ª£c Camera: " + err.message);
            }
            
            // B·∫Øt ƒë·∫ßu v·∫Ω sao
            initStars();
            animate();
        }

        // --- ANIMATION LOOP ---
        function animate() {
            ctx.fillStyle = "#000000";
            ctx.fillRect(0, 0, width, height);

            rotation += speed;

            ctx.save();
            ctx.translate(width/2, height/2);
            ctx.rotate(rotation);
            stars.forEach(s => s.draw());
            ctx.restore();

            // V·∫Ω con tr·ªè tay
            if (hand.active) {
                ctx.beginPath();
                ctx.arc(hand.x, hand.y, 20, 0, Math.PI*2);
                ctx.strokeStyle = "#00ff88";
                ctx.lineWidth = 3;
                ctx.stroke();
                
                // T√¢m
                ctx.beginPath();
                ctx.arc(hand.x, hand.y, 5, 0, Math.PI*2);
                ctx.fillStyle = "#00ff88";
                ctx.fill();
            }

            requestAnimationFrame(animate);
        }

        window.addEventListener('resize', initStars);
    </script>
</body>
</html>
