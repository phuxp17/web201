<!-- <!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code free</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #1e293b, #0f172a);
            color: #f8fafc;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        .container {
            background: rgba(30, 41, 59, 0.9);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
            text-align: center;
            max-width: 320px;
            width: 100%;
            border: 1px solid rgba(148, 163, 184, 0.3);
        }

        input {
            width: 100%;
            padding: 10px;
            border: 1px solid #64748b;
            border-radius: 6px;
            font-size: 14px;
            margin-bottom: 15px;
            outline: none;
            background: #0f172a;
            color: #f8fafc;
            transition: border 0.2s;
        }

        input::placeholder {
            color: #94a3b8;
        }

        input:focus {
            border-color: #3b82f6;
        }

        button {
            background-color: #3b82f6;
            color: white;
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s, transform 0.1s;
        }

        button:hover {
            background-color: #2563eb;
            transform: scale(1.05);
        }

        img {
            display: block;
            margin: 15px auto 0;
            border-radius: 8px;
            background: white;
            padding: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <input id="qr" placeholder="Enter url">
        <img alt="QR Code" id="qrimg">
        <button 
            onclick="qrimg.src='https://api.qrserver.com/v1/create-qr-code/?size=150x150&data='+encodeURIComponent(qr.value)">
            Generate
        </button>
    </div>
</body>
</html>
 -->
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>V≈© Tr·ª• Di ƒê·ªông (Fix)</title>
    
    <!-- T·∫£i th∆∞ vi·ªán -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>

    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #050510;
            font-family: sans-serif;
            touch-action: none; /* Ch·∫∑n k√©o trang */
        }

        canvas {
            display: block;
            width: 100vw;
            height: 100vh;
        }

        /* Modal th√¥ng ƒëi·ªáp */
        #message-modal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            background: rgba(15, 25, 50, 0.95);
            border: 1px solid rgba(100, 200, 255, 0.5);
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            color: #fff;
            box-shadow: 0 0 40px rgba(0, 200, 255, 0.3);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 100;
            width: 80%;
            max-width: 320px;
        }

        #message-modal.active {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }

        #message-text {
            font-size: 1.4rem;
            margin: 15px 0;
            color: #a1c4fd;
            font-weight: bold;
        }

        /* Th√¥ng b√°o tr·∫°ng th√°i/L·ªói */
        #status-bar {
            position: absolute;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.6);
            color: #00ff88;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            border: 1px solid #00ff88;
            z-index: 50;
            white-space: nowrap;
            max-width: 90%;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* N√∫t Camera */
        #cam-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            cursor: pointer;
            z-index: 51;
            border: 1px solid rgba(255,255,255,0.5);
        }

        /* H∆∞·ªõng d·∫´n d∆∞·ªõi ƒë√°y */
        .hint {
            position: absolute;
            bottom: 20px;
            width: 100%;
            text-align: center;
            color: rgba(255,255,255,0.5);
            font-size: 0.8rem;
            pointer-events: none;
        }

        /* Video ·∫©n nh∆∞ng kh√¥ng t·∫Øt display ƒë·ªÉ tr√°nh l·ªói iOS */
        .video-input {
            position: absolute;
            width: 1px;
            height: 1px;
            opacity: 0;
            top: 0;
            left: 0;
            pointer-events: none;
        }
    </style>
</head>
<body>

    <div id="status-bar">ƒêang t·∫£i v≈© tr·ª•...</div>
    <div id="cam-btn" onclick="toggleMode()">üì∑</div>
    
    <div class="hint">
        ‚òùÔ∏è D√πng ng√≥n tr·ªè (Camera) ho·∫∑c Ch·∫°m tay (C·∫£m ·ª©ng) ƒë·ªÉ ch·ªçn sao
    </div>

    <video class="video-input" playsinline muted autoplay></video>
    <canvas id="sky"></canvas>

    <div id="message-modal">
        <h3 style="margin:0; color:#4facfe;">TH√îNG ƒêI·ªÜP</h3>
        <p id="message-text">...</p>
        <div style="font-size:0.8rem; color:#888">(Ch·∫°m ra ngo√†i ho·∫∑c n·∫Øm tay ƒë·ªÉ ƒë√≥ng)</div>
    </div>

    <script>
        const canvas = document.getElementById('sky');
        const ctx = canvas.getContext('2d');
        const modal = document.getElementById('message-modal');
        const msgText = document.getElementById('message-text');
        const statusBar = document.getElementById('status-bar');
        const videoElement = document.querySelector('.video-input');

        let width, height;
        let stars = [];
        
        // Tr·∫°ng th√°i ƒëi·ªÅu khi·ªÉn
        let controlState = { 
            x: -100, y: -100, 
            active: false, // C√≥ ƒëang t∆∞∆°ng t√°c kh√¥ng
            mode: 'CAMERA', // 'CAMERA' ho·∫∑c 'TOUCH'
            rotationSpeed: 0.0005 
        };
        
        let globalRotation = 0;
        let hoveredStarIndex = -1;
        let camera = null;
        let isFrontCamera = true;
        let hands = null;

        const messages = [
            "B·∫°n l√† m·ªôt ng√¥i sao s√°ng!", "H·∫°nh ph√∫c ·ªü ngay ƒë√¢y.", 
            "H√£y tin v√†o ƒëi·ªÅu k·ª≥ di·ªáu.", "M·ªçi chuy·ªán s·∫Ω ·ªïn th√¥i.",
            "V≈© tr·ª• y√™u th∆∞∆°ng b·∫°n.", "C∆∞·ªùi l√™n n√†o!",
            "Th√†nh c√¥ng ƒëang ƒë·∫øn g·∫ßn."
        ];

        // --- H·ªÜ TH·ªêNG SAO (VISUAL) ---
        class Star {
            constructor() { this.reset(); }
            reset() {
                const r = (Math.min(width, height)) * (0.2 + Math.random() * 1.5);
                const theta = Math.random() * Math.PI * 2;
                this.x = r * Math.cos(theta);
                this.y = r * Math.sin(theta);
                this.size = Math.random() * 2 + 0.5;
                this.baseSize = this.size;
                this.isSpecial = Math.random() < 0.15;
                if (this.isSpecial) {
                    this.size = 5 + Math.random() * 5;
                    this.baseSize = this.size;
                    this.color = `hsl(${Math.random()*60+200}, 100%, 80%)`;
                } else {
                    this.color = `rgba(255,255,255,${Math.random()*0.8+0.2})`;
                }
                this.blinkSpeed = 0.02 + Math.random() * 0.05;
                this.blinkAngle = Math.random() * Math.PI * 2;
            }
            update() {
                this.blinkAngle += this.blinkSpeed;
                const blink = Math.sin(this.blinkAngle);
                this.size = this.isSpecial 
                    ? this.baseSize + blink * 2 
                    : this.baseSize + blink * 0.5;
            }
            draw(ctx) {
                ctx.beginPath();
                ctx.arc(this.x, this.y, Math.max(0, this.size), 0, Math.PI * 2);
                if (this.isSpecial) {
                    ctx.shadowBlur = 15; ctx.shadowColor = this.color; ctx.fillStyle = "#fff";
                } else {
                    ctx.shadowBlur = 0; ctx.fillStyle = this.color;
                }
                ctx.fill();
            }
        }

        // --- X·ª¨ L√ù MEDIAPIPE (CAMERA) ---
        function onResults(results) {
            if (controlState.mode !== 'CAMERA') return;

            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                statusBar.innerText = "üñêÔ∏è ƒê√£ th·∫•y tay! D√πng ng√≥n tr·ªè...";
                const lm = results.multiHandLandmarks[0];
                const indexTip = lm[8];

                // X·ª≠ l√Ω t·ªça ƒë·ªô
                let sx = (1 - indexTip.x) * width; // M·∫∑c ƒë·ªãnh l·∫≠t ngang (g∆∞∆°ng)
                if (!isFrontCamera) sx = indexTip.x * width; // Cam sau kh√¥ng l·∫≠t
                let sy = indexTip.y * height;

                // Smoothing
                controlState.x += (sx - controlState.x) * 0.3;
                controlState.y += (sy - controlState.y) * 0.3;
                controlState.active = true;

                // Gesture: X√≤e tay (OPEN) ƒë·ªÉ m·ªü
                const wrist = lm[0];
                const tip = lm[8], pip = lm[6];
                const isOpen = Math.hypot(tip.x-wrist.x, tip.y-wrist.y) > 
                               Math.hypot(pip.x-wrist.x, pip.y-wrist.y) + 0.05; // Logic ƒë∆°n gi·∫£n h√≥a

                if (isOpen) {
                    if (hoveredStarIndex !== -1 && !modal.classList.contains('active')) {
                        openMessage();
                    }
                }
                
                // Logic Xoay
                const cx = width/2;
                if (sx < cx - width*0.3) controlState.rotationSpeed = -0.005;
                else if (sx > cx + width*0.3) controlState.rotationSpeed = 0.005;
                else controlState.rotationSpeed = 0;

            } else {
                statusBar.innerText = "üëÄ ƒêang t√¨m tay...";
                controlState.active = false;
                controlState.rotationSpeed = 0.0005;
            }
        }

        // --- X·ª¨ L√ù C·∫¢M ·ª®NG (TOUCH/MOUSE FALLBACK) ---
        function setupTouchEvents() {
            // Touch
            canvas.addEventListener('touchstart', handleTouch);
            canvas.addEventListener('touchmove', handleTouch);
            canvas.addEventListener('touchend', () => { 
                controlState.active = false; 
                controlState.rotationSpeed = 0.0005;
            });
            
            // Mouse
            canvas.addEventListener('mousemove', (e) => {
                if(controlState.mode === 'TOUCH') {
                    controlState.x = e.clientX;
                    controlState.y = e.clientY;
                    controlState.active = true;
                }
            });
            canvas.addEventListener('click', () => {
                if(controlState.mode === 'TOUCH' && hoveredStarIndex !== -1) openMessage();
                else if (modal.classList.contains('active')) closeMessage();
            });
        }

        function handleTouch(e) {
            if(controlState.mode === 'TOUCH') {
                e.preventDefault(); // Ch·∫∑n scroll
                const touch = e.touches[0];
                controlState.x = touch.clientX;
                controlState.y = touch.clientY;
                controlState.active = true;

                // Ch·∫°m v√†o sao ƒë·ªÉ m·ªü
                if (hoveredStarIndex !== -1 && !modal.classList.contains('active')) {
                   // C·∫ßn delay nh·∫π ho·∫∑c tap ri√™ng, ·ªü ƒë√¢y l√†m ƒë∆°n gi·∫£n: ch·∫°m tr√∫ng l√† m·ªü
                   openMessage();
                }
            }
        }

        // --- LOGIC CHUNG ---
        function init() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
            stars = [];
            for(let i=0; i<250; i++) stars.push(new Star());
            
            // M·∫∑c ƒë·ªãnh b·∫Øt ƒë·∫ßu ·ªü ch·∫ø ƒë·ªô CAMERA, nh∆∞ng setup s·∫µn Touch
            setupTouchEvents();
        }

        function checkHover() {
            hoveredStarIndex = -1;
            if (modal.classList.contains('active')) return;

            const cos = Math.cos(globalRotation);
            const sin = Math.sin(globalRotation);
            const cx = width/2, cy = height/2;

            for (let i = 0; i < stars.length; i++) {
                const s = stars[i];
                if (!s.isSpecial) continue;
                
                // T·ªça ƒë·ªô th·ª±c tr√™n m√†n h√¨nh
                const sx = cx + (s.x * cos - s.y * sin);
                const sy = cy + (s.x * sin + s.y * cos);
                
                // Kho·∫£ng c√°ch
                const dist = Math.hypot(sx - controlState.x, sy - controlState.y);
                if (dist < 50) { // B√°n k√≠nh 50px
                    hoveredStarIndex = i;
                    break;
                }
            }
        }

        function openMessage() {
            msgText.innerText = messages[Math.floor(Math.random()*messages.length)];
            modal.classList.add('active');
            createExplosion(controlState.x, controlState.y);
            if(navigator.vibrate) navigator.vibrate(50);
        }
        function closeMessage() { modal.classList.remove('active'); }

        function createExplosion(x, y) {
            const b = document.createElement('div');
            Object.assign(b.style, {
                position:'absolute', left:x+'px', top:y+'px', width:'10px', height:'10px',
                background:'white', borderRadius:'50%', boxShadow:'0 0 30px 10px white',
                transform:'translate(-50%,-50%)', transition:'all 0.5s', pointerEvents:'none', zIndex: 200
            });
            document.body.appendChild(b);
            setTimeout(()=> { b.style.transform='translate(-50%,-50%) scale(5)'; b.style.opacity='0'; }, 20);
            setTimeout(()=> b.remove(), 500);
        }

        // --- KH·ªûI ƒê·ªòNG CAMERA ---
        async function startCameraAI() {
            try {
                statusBar.innerText = "ƒêang kh·ªüi ƒë·ªông Camera AI...";
                
                hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
                hands.setOptions({
                    maxNumHands: 1,
                    modelComplexity: 0, // Lite mode
                    minDetectionConfidence: 0.5,
                    minTrackingConfidence: 0.5
                });
                hands.onResults(onResults);

                if(camera) { await camera.stop(); }
                
                camera = new Camera(videoElement, {
                    onFrame: async () => { await hands.send({image: videoElement}); },
                    width: 480, height: 640,
                    facingMode: isFrontCamera ? 'user' : 'environment'
                });

                await camera.start();
                statusBar.innerText = "Camera s·∫µn s√†ng! H√£y ƒë∆∞a tay l√™n.";
                controlState.mode = 'CAMERA';

            } catch (err) {
                console.error(err);
                statusBar.innerText = "L·ªói Camera. ƒê√£ chuy·ªÉn sang ch·∫ø ƒë·ªô C·∫£m ·ª©ng.";
                statusBar.style.color = "#ff5555";
                controlState.mode = 'TOUCH';
            }
        }

        // N√∫t chuy·ªÉn ch·∫ø ƒë·ªô
        window.toggleMode = function() {
            if (controlState.mode === 'CAMERA') {
                // Chuy·ªÉn sang Touch
                if(camera) { 
                    // T·∫Øt th·ªß c√¥ng stream ƒë·ªÉ ti·∫øt ki·ªám pin
                    const stream = videoElement.srcObject;
                    if(stream) stream.getTracks().forEach(t=>t.stop());
                }
                controlState.mode = 'TOUCH';
                statusBar.innerText = "Ch·∫ø ƒë·ªô: C·∫¢M ·ª®NG (Ch·∫°m ƒë·ªÉ ch∆°i)";
                statusBar.style.color = "#00aaff";
            } else {
                // Chuy·ªÉn sang Camera
                startCameraAI();
                statusBar.style.color = "#00ff88";
            }
        }

        // --- V√íNG L·∫∂P CH√çNH (ANIMATION LOOP) ---
        function animate() {
            // X√≥a canvas
            ctx.fillStyle = "#050510";
            ctx.fillRect(0, 0, width, height);

            // C·∫≠p nh·∫≠t g√≥c xoay
            globalRotation += controlState.rotationSpeed;

            // V·∫Ω V≈© tr·ª•
            ctx.save();
            ctx.translate(width/2, height/2);
            ctx.rotate(globalRotation);
            
            stars.forEach((s, i) => {
                s.update();
                // Highlight n·∫øu ƒëang hover
                if (i === hoveredStarIndex) {
                    ctx.save();
                    ctx.shadowBlur = 20; ctx.shadowColor = "#00ff88"; ctx.fillStyle = "#fff";
                    ctx.beginPath(); ctx.arc(s.x, s.y, s.size*2, 0, Math.PI*2); ctx.fill();
                    ctx.restore();
                } else {
                    s.draw(ctx);
                }
            });
            ctx.restore();

            // V·∫Ω Con tr·ªè (Cursor)
            if (controlState.active || controlState.mode === 'TOUCH') {
                checkHover(); // Ki·ªÉm tra va ch·∫°m

                ctx.beginPath();
                ctx.arc(controlState.x, controlState.y, 20, 0, Math.PI*2);
                ctx.lineWidth = 2;
                
                if (controlState.mode === 'CAMERA') {
                    ctx.strokeStyle = "#00ff88"; 
                    ctx.fillStyle = "rgba(0,255,136,0.1)";
                } else {
                    ctx.strokeStyle = "#00aaff"; // M√†u xanh d∆∞∆°ng cho Touch
                    ctx.fillStyle = "rgba(0,170,255,0.1)";
                }
                
                if (hoveredStarIndex !== -1) {
                    ctx.fillStyle = "rgba(255,255,255,0.3)"; // S√°ng l√™n khi tr√∫ng sao
                    ctx.lineWidth = 4;
                }

                ctx.fill(); ctx.stroke();
            }

            requestAnimationFrame(animate);
        }

        // --- KH·ªûI CH·∫†Y ---
        window.onload = function() {
            init();
            animate(); // QUAN TR·ªåNG: G·ªçi h√†m n√†y ƒë·ªÉ b·∫Øt ƒë·∫ßu v·∫Ω ngay l·∫≠p t·ª©c!
            
            // Th·ª≠ kh·ªüi ƒë·ªông camera sau 1s
            setTimeout(startCameraAI, 1000);
        };
        
        window.addEventListener('resize', init);

    </script>
</body>
</html>
